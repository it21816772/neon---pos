// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  // Switched to MySQL for local development per request
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  CASHIER
  MANAGER
}

enum OrderStatus {
  PENDING
  COMPLETED
  CANCELLED
}

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  passwordHash  String   @map("password_hash")
  role          UserRole @default(CASHIER)
  name          String?
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  orders        Order[]

  @@map("users")
}

model Category {
  id          String    @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  products    Product[]

  @@map("categories")
}

model Product {
  id          String    @id @default(uuid())
  name        String
  description String?
  priceCents  Int       @map("price_cents")
  categoryId  String    @map("category_id")
  barcode     String?   @unique
  imageUrl    String?   @map("image_url")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  category    Category  @relation(fields: [categoryId], references: [id])
  inventory   Inventory?
  orderItems  OrderItem[]

  @@map("products")
}

model Inventory {
  id        String   @id @default(uuid())
  productId String   @unique @map("product_id")
  quantity  Int      @default(0)
  minStock  Int      @default(0) @map("min_stock")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("inventory")
}

model Order {
  id           String      @id @default(uuid())
  userId       String      @map("user_id")
  subtotalCents Int        @map("subtotal_cents")
  taxCents     Int         @map("tax_cents")
  discountCents Int        @default(0) @map("discount_cents")
  totalCents   Int         @map("total_cents")
  paymentMethod String     @default("CASH") @map("payment_method")
  status       OrderStatus @default(PENDING)
  customerEmail String?    @map("customer_email")
  createdAt    DateTime    @default(now()) @map("created_at")
  updatedAt    DateTime    @updatedAt @map("updated_at")
  user         User        @relation(fields: [userId], references: [id])
  items        OrderItem[]
  receipts     Receipt[]

  @@map("orders")
}

model OrderItem {
  id           String   @id @default(uuid())
  orderId      String   @map("order_id")
  productId    String   @map("product_id")
  quantity     Int
  priceCents   Int      @map("price_cents")
  subtotalCents Int     @map("subtotal_cents")
  createdAt    DateTime @default(now()) @map("created_at")
  order        Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product      Product  @relation(fields: [productId], references: [id])

  @@map("order_items")
}

model Receipt {
  id         String   @id @default(uuid())
  orderId    String   @map("order_id")
  pdfUrl     String?  @map("pdf_url")
  emailSent  Boolean  @default(false) @map("email_sent")
  createdAt  DateTime @default(now()) @map("created_at")
  order      Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("receipts")
}

model Printer {
  id        String   @id @default(uuid())
  name      String
  type      String   // "thermal" | "pdf"
  config    String   @default("{}") // JSON config
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("printers")
}

